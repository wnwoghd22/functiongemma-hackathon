# Benchmark Run - 20260222_014541

## Command
```bash
python scripts/benchmark_strategy.py --strategy strategies.strategy_selective 
```

## Output
```text
[1/30] Running: weather_sf (easy)... F1=1.00 | 248ms | on-device
[2/30] Running: alarm_10am (easy)... F1=1.00 | 632ms | cloud (fallback)
[3/30] Running: message_alice (easy)... F1=0.00 | 1455ms | cloud (fallback)
[4/30] Running: weather_london (easy)... F1=1.00 | 253ms | on-device
[5/30] Running: alarm_6am (easy)... F1=1.00 | 1452ms | cloud (fallback)
[6/30] Running: play_bohemian (easy)... F1=1.00 | 377ms | on-device
[7/30] Running: timer_5min (easy)... F1=1.00 | 932ms | cloud (fallback)
[8/30] Running: reminder_meeting (easy)... F1=1.00 | 774ms | cloud (fallback)
[9/30] Running: search_bob (easy)... F1=1.00 | 763ms | cloud (fallback)
[10/30] Running: weather_paris (easy)... F1=1.00 | 735ms | cloud (fallback)
[11/30] Running: message_among_three (medium)... F1=1.00 | 1513ms | cloud (fallback)
[12/30] Running: weather_among_two (medium)... F1=1.00 | 661ms | cloud (fallback)
[13/30] Running: alarm_among_three (medium)... F1=1.00 | 497ms | on-device
[14/30] Running: music_among_three (medium)... F1=1.00 | 1346ms | cloud (fallback)
[15/30] Running: reminder_among_four (medium)... F1=1.00 | 1319ms | cloud (fallback)
[16/30] Running: timer_among_three (medium)... F1=1.00 | 999ms | cloud (fallback)
[17/30] Running: search_among_four (medium)... F1=1.00 | 1143ms | cloud (fallback)
[18/30] Running: weather_among_four (medium)... F1=1.00 | 498ms | on-device
[19/30] Running: message_among_four (medium)... F1=0.00 | 1606ms | cloud (fallback)
[20/30] Running: alarm_among_five (medium)... F1=1.00 | 572ms | on-device
[21/30] Running: message_and_weather (hard)... F1=1.00 | 826ms | cloud (fallback)
[22/30] Running: alarm_and_weather (hard)... F1=1.00 | 1257ms | cloud (fallback)
[23/30] Running: timer_and_music (hard)... F1=1.00 | 1194ms | cloud (fallback)
[24/30] Running: reminder_and_message (hard)... F1=0.50 | 1214ms | cloud (fallback)
[25/30] Running: search_and_message (hard)... F1=1.00 | 1296ms | cloud (fallback)
[26/30] Running: alarm_and_reminder (hard)... F1=1.00 | 1394ms | cloud (fallback)
[27/30] Running: weather_and_music (hard)... F1=1.00 | 455ms | cloud (fallback)
[28/30] Running: message_weather_alarm (hard)... F1=1.00 | 1132ms | cloud (fallback)
[29/30] Running: timer_music_reminder (hard)... F1=1.00 | 1679ms | cloud (fallback)
[30/30] Running: search_message_weather (hard)... F1=1.00 | 1403ms | cloud (fallback)

=== Benchmark Results ===

   # | Difficulty | Name                         |  Time (ms) |    F1 | Source
  ---+------------+------------------------------+------------+-------+---------------------
   1 | easy       | weather_sf                   |     248.36 |  1.00 | on-device
   2 | easy       | alarm_10am                   |     631.73 |  1.00 | cloud (fallback)
   3 | easy       | message_alice                |    1454.78 |  0.00 | cloud (fallback)
   4 | easy       | weather_london               |     253.27 |  1.00 | on-device
   5 | easy       | alarm_6am                    |    1451.58 |  1.00 | cloud (fallback)
   6 | easy       | play_bohemian                |     376.82 |  1.00 | on-device
   7 | easy       | timer_5min                   |     931.90 |  1.00 | cloud (fallback)
   8 | easy       | reminder_meeting             |     774.05 |  1.00 | cloud (fallback)
   9 | easy       | search_bob                   |     762.97 |  1.00 | cloud (fallback)
  10 | easy       | weather_paris                |     735.33 |  1.00 | cloud (fallback)
  11 | medium     | message_among_three          |    1513.48 |  1.00 | cloud (fallback)
  12 | medium     | weather_among_two            |     661.05 |  1.00 | cloud (fallback)
  13 | medium     | alarm_among_three            |     496.70 |  1.00 | on-device
  14 | medium     | music_among_three            |    1345.71 |  1.00 | cloud (fallback)
  15 | medium     | reminder_among_four          |    1319.20 |  1.00 | cloud (fallback)
  16 | medium     | timer_among_three            |     998.53 |  1.00 | cloud (fallback)
  17 | medium     | search_among_four            |    1143.15 |  1.00 | cloud (fallback)
  18 | medium     | weather_among_four           |     497.88 |  1.00 | on-device
  19 | medium     | message_among_four           |    1605.69 |  0.00 | cloud (fallback)
  20 | medium     | alarm_among_five             |     572.34 |  1.00 | on-device
  21 | hard       | message_and_weather          |     826.12 |  1.00 | cloud (fallback)
  22 | hard       | alarm_and_weather            |    1257.06 |  1.00 | cloud (fallback)
  23 | hard       | timer_and_music              |    1194.29 |  1.00 | cloud (fallback)
  24 | hard       | reminder_and_message         |    1214.13 |  0.50 | cloud (fallback)
  25 | hard       | search_and_message           |    1295.86 |  1.00 | cloud (fallback)
  26 | hard       | alarm_and_reminder           |    1393.59 |  1.00 | cloud (fallback)
  27 | hard       | weather_and_music            |     454.88 |  1.00 | cloud (fallback)
  28 | hard       | message_weather_alarm        |    1132.21 |  1.00 | cloud (fallback)
  29 | hard       | timer_music_reminder         |    1679.04 |  1.00 | cloud (fallback)
  30 | hard       | search_message_weather       |    1403.09 |  1.00 | cloud (fallback)

--- Summary ---
  easy     avg F1=0.90  avg time=762.08ms  on-device=3/10 cloud=7/10
  medium   avg F1=0.90  avg time=1015.37ms  on-device=3/10 cloud=7/10
  hard     avg F1=0.95  avg time=1185.03ms  on-device=0/10 cloud=10/10
  overall  avg F1=0.92  avg time=987.49ms  total time=29624.77ms
           on-device=6/30 (20%)  cloud=24/30 (80%)

==================================================
  TOTAL SCORE: 59.2%
==================================================
```

## Version
v2.2 — `_generate_cactus_tuned()` 적용 (confidence_threshold=0.0, temperature=0.2, tool_rag_top_k=0, max_tokens=512)

## v2.1 대비 비교

| 지표 | v2.1 | v2.2 | 변화 |
|------|------|------|------|
| F1 | 0.96 | 0.92 | -0.04 ↓ |
| On-device | 20% (6/30) | 20% (6/30) | 동일 |
| Total Score | 60.9% | 59.2% | -1.7%p ↓ |

## 실패 케이스 분석

### 1. `message_alice` (easy) — F1=0.00

- **입력:** `"Send a message to Alice saying good morning."`
- **기대:** `send_message(recipient="Alice", message="good morning")`
- **라우팅:** cloud fallback (1455ms)
- **실패 원인:** 클라우드(Gemini)가 `send_message`를 호출했으나 argument 값이 expected와 불일치.
  클라우드가 `"Good morning"` 또는 `"Good morning."` 등으로 생성하여 `_normalize()` (strip+lower)로도 매칭 실패 가능.
  또는 function name은 맞지만 argument key 불일치 (예: `"text"` vs `"message"`).
- **영향:** easy F1을 1.00 → 0.90으로 하락시킴 (weight 20%)

### 2. `message_among_four` (medium) — F1=0.00

- **입력:** `"Text Dave saying I'll be late."`
- **기대:** `send_message(recipient="Dave", message="I'll be late")`
- **도구 수:** 4개 (get_weather, set_timer, send_message, play_music)
- **라우팅:** cloud fallback (1606ms) — Gate 7 (many_tools_low_conf: 4 tools ≥ 3) 또는 Gate 8 (low_confidence)
- **실패 원인:** 클라우드가 `"I will be late"` (apostrophe 풀어씀) 또는 다른 변형으로 생성.
  `_normalize()`는 strip+lower만 수행하므로 `"i'll be late"` ≠ `"i will be late"`.
- **영향:** medium F1을 1.00 → 0.90으로 하락시킴 (weight 30%)

### 3. `reminder_and_message` (hard) — F1=0.50

- **입력:** `"Remind me about groceries at 5:00 PM and text Lisa saying see you tonight."`
- **기대:** 2개 호출 — `create_reminder(title="groceries", time="5:00 PM")` + `send_message(recipient="Lisa", message="see you tonight")`
- **도구 수:** 4개
- **라우팅:** cloud fallback (1214ms) — Gate 6 (multi_action_under_called: "and" 감지)
- **실패 원인:** 2개 중 1개만 매칭 성공 (F1=0.50 → precision=0.5, recall=0.5 → 2개 예측 중 1개만 맞음).
  `create_reminder`는 매칭 성공, `send_message`는 argument 불일치로 추정.
  또는 `send_message`는 성공, `create_reminder`의 time 형식 불일치 (예: `"17:00"` vs `"5:00 PM"`).
- **영향:** hard F1을 1.00 → 0.95로 하락시킴 (weight 50% — 가장 큰 영향)

## 공통 패턴

3건 모두 **cloud fallback 후 argument 값 불일치**가 원인. 즉 라우팅 자체는 정상이나 클라우드 LLM의 출력이 strict matching 기준을 통과하지 못함.

**개선 방향:**
1. **`_normalize()` 완화:** apostrophe 정규화, 구두점 제거, contraction 확장 등 fuzzy matching 도입
2. **클라우드 프롬프트 개선:** "Use the exact words from the user's request" 등 지시 추가
3. **On-device 강화:** message 관련 단순 케이스(1-tool)를 on-device에서 처리하도록 Gate 조정

## Exit Status
`0`
